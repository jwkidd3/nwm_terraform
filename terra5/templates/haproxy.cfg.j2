global
    daemon
    maxconn 256

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

listen cluster
    bind {{ ec2_ip_address }}:80
    mode http
    stats enable
    balance roundrobin
{% for backend in groups['tag_web'] %}
    server {{ hostvars[backend]['ec2_dns_name'] }} {{ hostvars[backend].ec2_ip_address }} check port 80
{% endfor %}
    option httpchk HEAD /index.php HTTP/1.0


